import{b as z,j as e,u as I,r as p}from"./index-A6i-DHi-.js";import{u as U,a as D,b as T}from"./machine-BZGhzQyR.js";import{B as u}from"./index-BAaPsPyw.js";import{S as v,a as b,b as S,c as N,d as x,u as k,e as A,P as R,T as E,f as O,g as _,h as c,i as P,j as i,E as Q,k as V}from"./zodSchemas-CaNjZJV8.js";import{d as B,D as q,a as L,b as H,c as Z,e as $}from"./dialog-tRxNgY05.js";import{u as K,a as X,L as n,I as d}from"./label-COEXJ-nk.js";import{f as G}from"./utils-B5n6x0oC.js";import{Q as J,a as W}from"./QRCodeDisplay-DD793iDR.js";import"./useQuery-Dvotf5cw.js";import"./axiosClient-oslsaWBi.js";import"./createLucideIcon-CAhHQjTK.js";const Y=[{label:"Initial",value:"Initial"},{label:"Unit-1",value:"Unit-1"},{label:"Unit-2",value:"Unit-2"},{label:"Unit-3",value:"Unit-3"},{label:"CNC & Tool Room",value:"CNC_Tool_Room"}],ee=A;function se({machine:a,onSuccess:g,onCancel:o}){const h=z(),l=U({mutation:{onSuccess:()=>{h.invalidateQueries({queryKey:["/api/machines"]})}}}),m=D({mutation:{onSuccess:()=>{h.invalidateQueries({queryKey:["/api/machines"]})}}}),s=K({resolver:X(a?k:ee),defaultValues:a?{...a,machine_number:a.machine_number,red_tag:a.red_tag,zone:a.zone,date_of_issue:a.date_of_issue,manufacturer:a.manufacturer||"",model:a.model||"",status:a.status,created_at:a.created_at||new Date().toISOString(),updated_at:a.updated_at||new Date().toISOString(),description:a.description||""}:{machine_number:"",red_tag:"",zone:"",date_of_issue:new Date().toISOString(),manufacturer:"",model:"",status:"active",size_range:"",fixed_asset_number:"",unit:"Initial",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),description:""}});console.log(s.control._formState);const f=async r=>{try{a?(delete a.breakdowns,delete r.breakdowns,await m.mutateAsync({id:a.id||"",data:{...r,id:a.id}})):await l.mutateAsync({data:{...r}}),g()}catch(j){console.error("Error saving machine:",j),alert("Failed to save machine. Please try again.")}};return console.log(s.control._formState),e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"machine-form",onSubmit:s.handleSubmit(f),className:"space-y-4 p-3 h-full overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"machine_number",children:"Machine Number*"}),e.jsx(d,{id:"machine_number",...s.register("machine_number"),placeholder:"M-001"}),s.formState.errors.machine_number&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.machine_number.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"red_tag",children:"Red Tag*"}),e.jsx(d,{id:"red_tag",...s.register("red_tag"),placeholder:"RT-001"}),s.formState.errors.red_tag&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.red_tag.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"machine_number",children:"Fixed Asset Number*"}),e.jsx(d,{id:"fixed_asset_number",...s.register("fixed_asset_number"),placeholder:"001"}),s.formState.errors.fixed_asset_number&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.fixed_asset_number.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"red_tag",children:"Size Range*"}),e.jsx(d,{id:"size_range",...s.register("size_range"),placeholder:"0 - 1"}),s.formState.errors.size_range&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.size_range.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"zone",children:"Zone*"}),e.jsx(d,{id:"zone",...s.register("zone"),placeholder:"Zone A"}),s.formState.errors.zone&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.zone.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"date_of_issue",children:"Date of Issue*"}),e.jsx(d,{id:"date_of_issue",type:"date",...s.register("date_of_issue")}),s.formState.errors.date_of_issue&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.date_of_issue.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"manufacturer",children:"Manufacturer"}),e.jsx(d,{id:"manufacturer",...s.register("manufacturer"),placeholder:"ACME Corp"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"model",children:"Model"}),e.jsx(d,{id:"model",...s.register("model"),placeholder:"Model X-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"unit",children:"Unit*"}),e.jsxs(v,{...s.register("unit"),onValueChange:r=>s.setValue("unit",r),children:[e.jsx(b,{id:"unit",children:e.jsx(S,{placeholder:"Select unit"})}),e.jsx(N,{children:Y.map(r=>e.jsx(x,{value:r.value,children:r.label},r.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"status",children:"Status*"}),e.jsxs(v,{value:s.watch("status"),onValueChange:r=>s.setValue("status",r),children:[e.jsx(b,{children:e.jsx(S,{placeholder:"Select status"})}),e.jsxs(N,{children:[e.jsx(x,{value:"active",children:"Active"}),e.jsx(x,{value:"inactive",children:"Inactive"}),e.jsx(x,{value:"under_maintenance",children:"Under Maintenance"})]})]})]})]})}),e.jsx(B,{children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:o,children:"Cancel"}),e.jsx(u,{form:"machine-form",type:"submit",disabled:l.isPending||m.isPending,children:l.isPending||m.isPending?"Saving...":a?"Update Machine":"Add Machine"})]})})]})}const ae=[{label:"Initial",value:"Initial"},{label:"Unit-1",value:"Unit-1"},{label:"Unit-2",value:"Unit-2"},{label:"Unit-3",value:"Unit-3"},{label:"CNC & Tool Room",value:"CNC_Tool_Room"}];function te(){const a=I(),[g,o]=p.useState(!1),[h,l]=p.useState(null),[m,s]=p.useState(null),[f,r]=p.useState({}),{data:j=[],isLoading:y}=T({filters:f}),C=t=>{l(t),o(!0)},M=()=>{l(null),o(!0)},w=()=>{o(!1),l(null)},F=()=>{o(!1),l(null)};return y?e.jsx("div",{className:"text-center py-8",children:"Loading machines..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-end flex-wrap",children:[e.jsx("div",{className:"space-y-2 mr-2",children:e.jsxs(v,{onValueChange:t=>{console.log(t),r({unit:{$eq:t}})},children:[e.jsx(b,{className:"w-35",children:e.jsx(S,{placeholder:"Select unit"})}),e.jsx(N,{children:ae.map(t=>e.jsx(x,{value:t.value,children:t.label},t.value))})]})}),e.jsxs(u,{onClick:M,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Add Machine"]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(E,{children:[e.jsx(O,{children:e.jsxs(_,{children:[e.jsx(c,{children:"Model"}),e.jsx(c,{children:"Machine Number"}),e.jsx(c,{children:"Fixed Asset Number"}),e.jsx(c,{children:"Date of Introduction"}),e.jsx(c,{children:"Zone"}),e.jsx(c,{children:"Size Range"}),e.jsx(c,{children:"Number of Breakdowns"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsx(P,{children:j.length===0?e.jsx(_,{children:e.jsx(i,{colSpan:7,className:"text-center text-muted-foreground",children:"No machines found"})}):j.map(t=>e.jsxs(_,{children:[e.jsx(i,{className:"font-medium",children:t.model}),e.jsx(i,{children:t.machine_number}),e.jsx(i,{children:t.fixed_asset_number}),e.jsx(i,{children:G(t.date_of_issue)}),e.jsx(i,{children:t.zone}),e.jsx(i,{children:t.size_range}),e.jsx(i,{children:t.breakdowns?.length||0}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-1",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>s(t),title:"Show QR Code",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>a({to:"/machines/$machineId",params:{machineId:t.id||""}}),title:"View Details & Breakdowns",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>C(t),title:"Edit Machine",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},t.id))})]})}),e.jsx(q,{open:g,onOpenChange:o,children:e.jsxs(L,{className:"max-w-2xl max-h-[80vh] h-full",children:[e.jsxs(H,{children:[e.jsx(Z,{children:h?"Edit Machine":"Add New Machine"}),e.jsx($,{children:h?"Update the machine details below.":"Fill in the details to add a new machine to the system."})]}),e.jsx(se,{machine:h||void 0,onSuccess:w,onCancel:F})]})}),m&&e.jsx(W,{machine:m,isOpen:!!m,onClose:()=>s(null)})]})}function re(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Machines"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your machine inventory and track their maintenance status"})]}),e.jsx(te,{})]})}const pe=re;export{pe as component};
